<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Portfolio CMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/js/all.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }
        .tab-active {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="glass p-4 mb-8">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white">Portfolio CMS Dashboard</h1>
            <div class="flex items-center space-x-4">
                <span id="userEmail" class="text-gray-300"></span>
                <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                    Logout
                </button>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6">
        <!-- Tabs -->
        <div class="flex space-x-4 mb-8">
            <button id="projectsTab" class="tab-active glass px-6 py-3 text-white rounded-lg transition-all">Projects</button>
            <button id="blogTab" class="glass px-6 py-3 text-white rounded-lg transition-all">Blog Posts</button>
            <button id="contactsTab" class="glass px-6 py-3 text-white rounded-lg transition-all">Contacts</button>
        </div>

        <!-- Content Area -->
        <div id="contentArea" class="glass p-6">
            <!-- Loading -->
            <div id="loading" class="text-center py-20">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-400 mb-4"></i>
                <p class="text-gray-400">Loading...</p>
            </div>

            <!-- Projects Table -->
            <div id="projectsContent" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Projects Management</h2>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Project
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="pb-3 text-gray-300">Title</th>
                                <th class="pb-3 text-gray-300">Technologies</th>
                                <th class="pb-3 text-gray-300">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody">
                            <!-- Projects will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Blog Posts Table -->
            <div id="blogContent" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Blog Posts Management</h2>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Post
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="pb-3 text-gray-300">Title</th>
                                <th class="pb-3 text-gray-300">Published</th>
                                <th class="pb-3 text-gray-300">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blogTableBody">
                            <!-- Blog posts will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contacts Table -->
            <div id="contactsContent" class="hidden">
                <h2 class="text-2xl font-bold text-white mb-6">Contact Messages</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="pb-3 text-gray-300">Name</th>
                                <th class="pb-3 text-gray-300">Email</th>
                                <th class="pb-3 text-gray-300">Message</th>
                                <th class="pb-3 text-gray-300">Read</th>
                                <th class="pb-3 text-gray-300">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactsTableBody">
                            <!-- Contacts will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        const token = localStorage.getItem('accessToken');
        if (!token) {
            window.location.href = '/admin.html';
        }

        // DOM elements
        const projectsTab = document.getElementById('projectsTab');
        const blogTab = document.getElementById('blogTab');
        const contactsTab = document.getElementById('contactsTab');
        const contentArea = document.getElementById('contentArea');
        const loading = document.getElementById('loading');
        const logoutBtn = document.getElementById('logoutBtn');

        // Tab switching
        function switchTab(tabName) {
            // Reset active tab
            [projectsTab, blogTab, contactsTab].forEach(tab => {
                tab.classList.remove('tab-active');
            });

            // Hide all content
            document.querySelectorAll('[id$="Content"]').forEach(content => {
                content.classList.add('hidden');
            });

            // Show selected tab
            if (tabName === 'projects') {
                projectsTab.classList.add('tab-active');
                document.getElementById('projectsContent').classList.remove('hidden');
                loadProjects();
            } else if (tabName === 'blog') {
                blogTab.classList.add('tab-active');
                document.getElementById('blogContent').classList.remove('hidden');
                loadBlogPosts();
            } else if (tabName === 'contacts') {
                contactsTab.classList.add('tab-active');
                document.getElementById('contactsContent').classList.remove('hidden');
                loadContacts();
            }
        }

        // Event listeners
        projectsTab.addEventListener('click', () => switchTab('projects'));
        blogTab.addEventListener('click', () => switchTab('blog'));
        contactsTab.addEventListener('click', () => switchTab('contacts'));

        logoutBtn.addEventListener('click', async () => {
            try {
                await fetch('http://localhost:3001/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            window.location.href = '/admin.html';
        });

        // Load data functions
        async function loadProjects() {
            try {
                const response = await fetch('http://localhost:3001/api/projects', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const projects = await response.json();

                const tbody = document.getElementById('projectsTableBody');
                tbody.innerHTML = projects.map(project => `
                    <tr class="border-b border-gray-700">
                        <td class="py-3 text-white">${project.title}</td>
                        <td class="py-3 text-gray-300">${project.technologies.join(', ')}</td>
                        <td class="py-3">
                            <button class="text-blue-400 hover:text-blue-300 mr-3">Edit</button>
                            <button class="text-red-400 hover:text-red-300">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        async function loadBlogPosts() {
            try {
                const response = await fetch('http://localhost:3001/api/blog/admin/all', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const posts = await response.json();

                const tbody = document.getElementById('blogTableBody');
                tbody.innerHTML = posts.map(post => `
                    <tr class="border-b border-gray-700">
                        <td class="py-3 text-white">${post.title}</td>
                        <td class="py-3 text-gray-300">${post.published ? 'Yes' : 'No'}</td>
                        <td class="py-3">
                            <button class="text-blue-400 hover:text-blue-300 mr-3">Edit</button>
                            <button class="text-red-400 hover:text-red-300">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading blog posts:', error);
            }
        }

        async function loadContacts() {
            try {
                const response = await fetch('http://localhost:3001/api/contact', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const contacts = await response.json();

                const tbody = document.getElementById('contactsTableBody');
                tbody.innerHTML = contacts.map(contact => `
                    <tr class="border-b border-gray-700">
                        <td class="py-3 text-white">${contact.name}</td>
                        <td class="py-3 text-gray-300">${contact.email}</td>
                        <td class="py-3 text-gray-300 max-w-xs truncate">${contact.message}</td>
                        <td class="py-3 text-gray-300">${contact.read ? 'Yes' : 'No'}</td>
                        <td class="py-3">
                            ${!contact.read ? '<button class="text-green-400 hover:text-green-300 mr-3">Mark Read</button>' : ''}
                            <button class="text-red-400 hover:text-red-300">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }

        // Initialize
        loading.classList.add('hidden');
        switchTab('projects');
    </script>
</body>
</html>